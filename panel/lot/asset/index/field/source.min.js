!function(){"use strict";var e=function(e,r){return-1!==r.indexOf(e)},r=function(e){return Array.isArray(e)},t=function(e){return"function"==typeof e},n=function(e,r){return e&&i(r)&&e instanceof r},o=function(e,r){return void 0===r&&(r=!0),"object"==typeof e&&(!r||n(e,Object))},i=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},s=function(e){return"string"==typeof e},c=function(e){return e.length},a=function(e,r){return i(r[0])&&e<r[0]?r[0]:i(r[1])&&e>r[1]?r[1]:e},u=function(e){return Object.keys(e)},l=function e(t){if(r(t))return t.map((function(r){return e(r)}));if(function(e){return/^-?(?:\d*.)?\d+$/.test(e+"")}(t))return function(e,r){return void 0===r&&(r=10),r?parseInt(e,r):parseFloat(e)}(t);if(o(t)){for(var n in t)t[n]=e(t[n]);return t}return"false"!==t&&("null"===t?null:"true"===t||t)},f=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},p=function t(){for(var n=arguments.length,s=Array(n),a=0;a<n;a++)s[a]=arguments[a];for(var u=s.shift(),l=0,f=c(s);l<f;++l)for(var p in s[l])if(i(u[p]))if(r(u[p])&&r(s[l][p])){u[p]=[].concat(u[p]);for(var h=0,v=c(s[l][p]);h<v;++h)e(s[l][p][h],u[p])||u[p].push(s[l][p][h])}else o(u[p])&&o(s[l][p])?u[p]=t({},u[p],s[l][p]):u[p]=s[l][p];else u[p]=s[l][p];return u},h=function e(t){if(r(t))return t.map((function(r){return e(t)}));if(o(t)){for(var n in t)t[n]=e(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},v=document,d=window,m=v.body,g=v.documentElement,b=function(e,r,t){void 0===t&&(t=!0);var n=function(e,r,t){if(void 0===t&&(t=!0),!y(e,r))return null;var n=e.getAttribute(r);return t?l(n):n}(e,"data-"+r,t),o=(n+"").trim();return t&&o&&("["===o[0]&&"]"===o.slice(-1)||"{"===o[0]&&"}"===o.slice(-1))&&null!==(o=function(e){var r=null;try{r=JSON.parse(e)}catch(e){}return r}(n))?o:n},y=function(e,r){return e.hasAttribute(r)},$=d.location,w=function(e,r,t){r.removeEventListener(e,t)},k=function(e){return e&&e.preventDefault()},S=function(e,r,t,n){void 0===n&&(n=!1),r.addEventListener(e,t,n)},x=function(e,r){return void 0===r&&(r=""),e.replace(T("["+r+q.replace(/./g,"\\$&")+"]"),"\\$&")},T=function(e,r){return function(e){return n(e,RegExp)}(e)?e:(e=e.replace(/\//g,"\\/"),RegExp(e,i(r)?r:"g"))},q="!$^*()+=[]{}|:<>,.?/-";function L(e,r){return(e||"")["trim"+(-1===r?"Left":1===r?"Right":"")]()}function _(e,o){void 0===o&&(o={});var a=this;if(!e)return a;if(e.TE)return e.TE;if(!n(a,_))return new _(e,o);a.state=o=p({},_.state,s(o)?{tab:o}:o||{}),a.self=a.source=e,_.instances[e.id||e.name||function(e){return c(u(e))}(_.instances)]=a,e.TE=a;var l=/^([\s\S]*?)$/,f=function(){return e.disabled},h=function(){return e.readOnly},v=function(){return e.value.replace(/\r/g,"")};return a.value=v(),a.get=function(){return!f()&&L(v())||null},a.let=function(){return e.value=a.value,a},a.set=function(r){return f()||h()||(e.value=r),a},a.$=function(){return new _.S(e.selectionStart,e.selectionEnd,v())},a.focus=function(r){var t,n;return-1===r?t=n=0:1===r&&(t=c(v()),n=e.scrollHeight),i(t)&&i(n)&&(e.selectionStart=e.selectionEnd=t,e.scrollTop=n),e.focus(),a},a.blur=function(){return e.blur(),a},a.select=function(){if(f()||h())return e.focus(),a;for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];var o,i,s,u,l=c(t),p=a.$(),v=p.start,b=p.end;if(o=d.pageXOffset||g.scrollLeft||m.scrollLeft,i=d.pageYOffset||g.scrollTop||m.scrollTop,s=e.scrollLeft,u=e.scrollTop,0===l)t[0]=v,t[1]=b;else if(1===l){if(!0===t[0])return e.focus(),e.select(),a;t[1]=t[0]}return e.focus(),e.selectionStart=t[0],e.selectionEnd=t[1],e.scrollLeft=s,e.scrollTop=u,d.scroll(o,i),a},a.match=function(e,n){var o=a.$(),i=o.after,s=o.before,c=o.value;if(r(e)){var u=[s.match(e[0]),c.match(e[1]),i.match(e[2])];return t(n)?n.call(a,u[0]||[],u[1]||[],u[2]||[]):[!!u[0],!!u[1],!!u[2]]}var l=c.match(e);return t(n)?n.call(a,l||[]):!!l},a.replace=function(e,r,t){var n=a.$(),o=n.after,i=n.before,s=n.value;return-1===t?i=i.replace(e,r):1===t?o=o.replace(e,r):s=s.replace(e,r),a.set(i+s+o).select(i=c(i),i+c(s))},a.insert=function(e,r,t){var n=l;return t&&a.replace(n,""),-1===r?n=/$/:1===r&&(n=/^/),a.replace(n,e,r)},a.wrap=function(e,r,t){var n=a.$(),o=n.after,i=n.before,s=n.value;return t?a.replace(l,e+"$1"+r):a.set(i+e+s+r+o).select(i=c(i+e),i+c(s))},a.peel=function(e,r,t){var n=a.$(),o=n.after,i=n.before,s=n.value;e=x(e),r=x(r);var u=T(e+"$",""),l=T("^"+r,"");return t?a.replace(T("^"+e+"([\\s\\S]*?)"+r+"$",""),"$1"):u.test(i)&&l.test(o)?(i=i.replace(u,""),o=o.replace(l,""),a.set(i+s+o).select(i=c(i),i+c(s))):a.select()},a.pull=function(e,r){void 0===r&&(r=!0);var t=a.$(),n=t.length,s=t.value;return e=x(i(e)?e:o.tab),n?r?a.replace(T("^"+e,"gm"),""):a.insert(s.split("\n").map((function(r){return T("^("+e+")*$","").test(r)?r:r.replace(T("^"+e,""),"")})).join("\n")):a.replace(T(e+"$",""),"",-1)},a.push=function(e,r){void 0===r&&(r=!1);var t=a.$().length;return e=i(e)?e:o.tab,t?a.replace(T("^"+(r?"":"(?!$)"),"gm"),e):a.insert(e,-1)},a.trim=function(e,r,t,n,o){void 0===o&&(o=!0),null!==e&&!1!==e&&(e=e||""),null!==r&&!1!==r&&(r=r||""),null!==t&&!1!==t&&(t=t||""),null!==n&&!1!==n&&(n=n||"");var i=a.$(),s=i.before,u=i.value,l=i.after,f=L(s,1),p=L(l,-1);return s=!1!==e?L(s,1)+(f||!o?e:""):s,l=!1!==r?(p||!o?r:"")+L(l,-1):l,!1!==t&&(u=L(u,-1)),!1!==n&&(u=L(u,1)),a.set(s+u+l).select(s=c(s),s+c(u))},a.pop=function(){return e.TE?(delete e.TE,a):a},a.state=o,a}_.esc=x,_.instances={},_.state={tab:"\t"},_.S=function(e,r,t){var n=this,o=t.slice(e,r);n.after=t.slice(r),n.before=t.slice(0,e),n.end=r,n.length=c(o),n.start=e,n.value=o,n.toString=function(){return o}},_.version="3.3.10",_.x=q;var E={_history:[],_historyState:-1,history:function(e){var r=this;return i(e)?i(r._history[e])?r._history[e]:null:r._history},loss:function(e){var r,t=this;return!0===e?(t._history=[],t._historyState=-1,[]):(r=t._history.splice(i(e)?e:t._historyState,1),t._historyState=a(t._historyState-1,[-1]),r)},record:function(e){var r=this,t=r.$(),n=t.end,o=t.start,s=r._history[r._historyState]||[],c=[r.self.value,o,n];return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]||(++r._historyState,r._history[i(e)?e:r._historyState]=c),r},redo:function(){var e,r=this;return r._historyState=a(r._historyState+1,[0,c(r._history)-1]),e=r._history[r._historyState],r.set(e[0]).select(e[1],e[2])},undo:function(){var e,r=this;return r._historyState=a(r._historyState-1,[0,c(r._history)-1]),e=r._history[r._historyState],r.set(e[0]).select(e[1],e[2])}};function C(e,r){return new Promise((function(t,n){var o=d[e].apply(d,r);return o?t(o):n(o)}))}var M={source:{pairs:{"`":"`","(":")","{":"}","[":"]",'"':'"',"'":"'","<":">"},type:null}};["alert","confirm","prompt"].forEach((function(e){M.source[e]=function(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];return C(e,t)}}));var A={toggle:function(e,t,n,o){void 0===o&&(o=!1),t||""===t||(t=e);var i=this,a=i.$(),u=a.after,l=a.before,f=a.value,p=c(t),h=c(e);return n&&t===f.slice(-p)&&e===f.slice(0,h)||t===u.slice(0,p)&&e===l.slice(-h)?i.peel(e,t,n):(!1!==o&&(s(o)?o=[o,o]:r(o)||(o=["",""]),isSet(o[1])||(o[1]=o[0]),i.trim(o[0],o[1])),i.wrap(e,t,n))}};function H(r,t){var n,o,i=t.state.source.tab||t.state.tab||"\t",s=t.state.source.pairs||{},c=function(e){return Object.values(e)}(s),a=r.key,u=r.queue,l=r+"";if(u.Alt||u.Control)return!0;if(" "===l){var f=t.$(),p=f.after,h=f.before,v=f.value;return n=s[o=h.slice(-1)],!(!v&&n&&o&&n===p[0])||(t.wrap(" "," "),!1)}if("Enter"===l){var d=t.$(),m=d.after,g=d.before,b=d.value,y=g.split("\n").pop().match(/^(\s+)/),$=y&&y[1]||"";if(!b){if(m&&g&&(n=s[o=g.slice(-1)])&&n===m[0])return t.wrap("\n"+$+(o!==n?i:""),"\n"+$).record(),!1;if($)return t.insert("\n"+$,-1).record(),!1}return!0}if("Backspace"===l){var w=t.$(),k=w.after,S=w.before,x=w.value;k.split("\n")[0];var T=S.split("\n").pop(),q=T.match(/^(\s+)/),L=q&&q[1]||"";return n=s[o=S.slice(-1)],"\\"===o?!0:x?!(k&&S&&n&&n===k[0]&&!S.endsWith("\\"+o))||(t.record().peel(o,n).record(),!1):(n=s[o=S.trim().slice(-1)])&&o&&(k.startsWith(" "+n)&&S.endsWith(o+" ")||k.startsWith("\n"+L+n)&&S.endsWith(o+"\n"+L))?(t.trim("","").record(),!1):T.endsWith(i)?(t.pull(i).record(),!1):!(k&&S&&!S.endsWith("\\"+o)&&n===k[0]&&o===S.slice(-1))||(t.peel(o,n).record(),!1)}var _=t.$(),E=_.after,C=_.before,M=_.start,A=_.value;if("\\"===(o=C.slice(-1)))return!0;if(n=e(E[0],c)?E[0]:s[o],!A&&E&&C&&n&&a===n)return t.select(M+1).record(),!1;for(o in s){if(n=s[o],a===o&&n)return t.wrap(o,n).record(),!1;if(a===n){if(A)return t.record().wrap(o,n).record(),!1;break}}return!0}function W(e,r){var t=r.state.source.tab||r.state.tab||"\t";e.key,e.queue;var n=e+"";return"Control-]"===n?(r.push(t).record(),!1):"Control-["!==n||(r.pull(t).record(),!1)}function j(e,r){e.key;var t=e.queue;if(t.Control&&t.Enter){var n=r.$(),o=n.after,i=n.before,s=n.end,a=n.start,u=n.value,l=o.split("\n").shift(),f=i.split("\n").pop(),p=f.match(/^(\s+)/),h=p&&p[1]||"";if(i||o)return t.Shift?(r.select(a-c(f)).wrap(h,"\n").insert(u).record(),!1):(r.select(s+c(l)).wrap("\n"+h,"").insert(u).record(),!1)}return!0}function O(e,r){var t=e+"";return"Control-y"===t?(r.redo(),!1):"Control-z"!==t||(r.undo(),!1)}function K(r,t){r.key;var n=r+"";if(!r.queue.Control)return!0;var o,i,s,a=t.$(),u=a.after,l=a.before,f=a.end,p=a.start,h=a.value,v=t.state.source.pairs||{},d=[];if(h){for(o in v)(i=v[o])&&d.push("(?:\\"+o+"(?:\\\\.|[^\\"+o+(i!==o?"\\"+i:"")+"])*\\"+i+")");if(d.push("\\w+"),d.push("\\s+"),d.push("[\\s\\S]"),"Control-ArrowLeft"===n)return(s=l.match(T("("+d.join("|")+")$","")))?(t.insert("").select(p-c(s[0])).insert(h),t.record(),!1):(t.select(),!1);if("Control-ArrowRight"===n)return(s=u.match(T("^("+d.join("|")+")","")))?(t.insert("").select(f+c(s[0])-c(h)).insert(h),t.record(),!1):(t.select(),!1)}var m=u.split("\n").shift(),g=l.split("\n").pop(),b=g.match(/^(\s+)/);if(b&&b[1],f+=c(m),p-=c(g),h=g+h+m,"Control-ArrowUp"===n){if(!e("\n",l))return t.select(),!1;t.insert(""),t.replace(/^([^\n]*?)(\n|$)/,"$2",1),t.replace(/(^|\n)([^\n]*?)$/,"",-1);var y=t.$();return l=y.before,p=y.start,g=l.split("\n").pop(),t.select(p-=c(g)).wrap(h,"\n"),t.select(p,p+c(h)),t.record(),!1}if("Control-ArrowDown"===n){if(!e("\n",u))return t.select(),!1;t.insert(""),t.replace(/^([^\n]*?)(\n|$)/,"",1),t.replace(/(^|\n)([^\n]*?)$/,"$1",-1);var $=t.$();return u=$.after,f=$.end,m=u.split("\n").shift(),t.select(f+=c(m)).wrap("\n",h),f+=1,t.select(f,f+c(h)),t.record(),!1}return!0}var R,X,U,D=(R=function(e){return e.record()},X=100,function(){var e=arguments,r=this;U&&clearTimeout(U),U=setTimeout((function(){return R.apply(r,e)}),X)});var B=M,N="[\\w:.-]+",P=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"},z=function(e){return"</("+e+")>"},F="(?:\x3c!--([\\s\\S](?!--\x3e)*)--\x3e|<!((?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^>'\"])*)>|"+z(N)+"|<\\?((?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^>'\"])*)\\?>|"+P(N)+"|"+function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?/?>"}(N)+")",I={};function J(e){if(!e)return"";e=u(e).sort().reduce((function(r,t){return r[t]=e[t],r}),{});var r,t,n="";for(r in e)!1!==(t=e[r])&&null!==t&&(n+=" "+r,!0!==t&&(n+='="'+f(h(t))+'"'));return n}function Y(e){return!1!==e&&(s(e)?e=[e,e]:r(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}function G(e,r){var t=r.state,n=t.sourceXML.tab||t.tab||"\t",o=e.key,i=e.queue,s=e+"";if(i.Alt||i.Control)return!0;if(["-",">","/","?"," "].includes(o)){var a=r.$(),u=a.after,l=a.before,f=a.value,p=a.start;if("-"===o&&!f&&"<!-"===l.slice(-3))return r.wrap("- "," --"+(">"===u[0]?"":">")).record(),!1;if(">"===o||"/"===o){var h=T(P(N)+"$","").exec(l+">");if(!f&&h)return"/"===o?">"===u[0]?(r.trim("",!1).insert(" /",-1).select(r.$().start+1).record(),!1):(r.trim("",!1).insert(" />",-1).record(),!1):(u.startsWith("></"+h[1]+">")?r.select(p+1).record():u.startsWith("</"+h[1]+">")?r.insert(">",-1).record():r.wrap(">","</"+h[1]+(">"===u[0]?"":">")).record(),!1)}if("?"===o&&!f&&"<"===l.slice(-1))return r.wrap("?","?"+(">"===u[0]?"":">")).record(),!1;if(" "===s&&!f&&("--\x3e"===u.slice(0,3)&&"\x3c!--"===l.slice(-4)||"?>"===u.slice(0,2)&&"<?"===l.slice(0,2)&&/<\?\S*$/.test(l)))return r.wrap(" "," ").record(),!1}if("ArrowLeft"===s){var v=r.$(),d=v.before,m=v.start;if(!v.value){var g=T(F+"$","").exec(d);if(g)return r.select(m-c(g[0]),m),!1}}if("ArrowRight"===s){var b=r.$(),y=b.after,$=b.start;if(!b.value){var w=T("^"+F,"").exec(y);if(w)return r.select($,$+c(w[0])),!1}}if("Enter"===s){var k=r.$(),S=k.after,q=k.before,L=k.value,_=q.split("\n").pop().match(/^(\s+)/),E=_&&_[1]||"",C=q.match(T(P(N)+"$",""));if(!L){if(/^[ \t]*-->/.test(S)&&/<!--[ \t]*$/.test(q)||/^[ \t]*\?>/.test(S)&&/<\?\S*[ \t]*$/.test(q))return r.trim().wrap("\n"+E,"\n"+E).record(),!1;if(C)return S.startsWith("</"+C[1]+">")?r.record().trim().wrap("\n"+E+n,"\n"+E).record():r.record().wrap("\n"+E+n,"\n"+E+"</"+C[1]+">").record(),!1}}if("Backspace"===s){var M=r.$(),A=M.after,H=M.before;if(!M.value){if("\x3c!--"===H.slice(-4))return r.replace(/<!--$/,"",-1),"--\x3e"===A.slice(0,3)&&r.replace(/^-->/,"",1),r.record(),!1;if(/^\s+-->/.test(A)&&/<!--\s+$/.test(H))return r.trim(" "===H.slice(-1)?"":" "," "===A[0]?"":" ").record(),!1;if(/<\?\S*$/.test(H))return r.replace(/<\?\S*$/,"",-1),"?>"===A.slice(0,2)&&r.replace(/^\?>/,"",1),r.record(),!1;if(/^\s+\?>/.test(A)&&/<\?\S*\s+$/.test(H))return r.trim(" "===H.slice(-1)?"":" "," "===A[0]?"":" ").record(),!1;var W=T(F+"$",""),j=W.exec(H);if(j){if(" />"===H.slice(-3))return r.replace(/ \/>$/,"/>",-1).record(),!1;if("/>"===H.slice(-2))return r.replace(/\/>$/,">",-1).record(),!1;r.replace(W,"",-1);var O=j[0].slice(1).split(/\s+|>/)[0];return j[0]&&"/"!==j[0][1]&&A.startsWith("</"+O+">")&&r.replace(T("^</"+O+">",""),"",1),r.record(),!1}if(T(P(N)+"\\n(?:"+x(n)+")?$","").test(H)&&T("^\\s*"+z(N),"").test(A))return r.trim().record(),!1}}if("Delete"===s){var K=r.$(),R=K.after;if(!K.value){if("--\x3e"===R.slice(0,3))return r.replace(/^-->/,"",1).record(),!1;if("?>"===R.slice(0,2))return r.replace(/^\?>/,"",1).record(),!1;var X=T("^"+F,"");if(X.exec(R))return r.replace(X,"",1).record(),!1}}return!0}I.insert=function(e,r,t,n){void 0===r&&(r=""),void 0===t&&(t={}),void 0===n&&(n=!1);return!1!==(n=Y(n))&&this.trim(n[0],""),this.insert("<"+e+J(t)+(!1!==r?">"+r+"</"+e+">":" />")+(!1!==n?n[1]:""),-1,!0)},I.toggle=function(e,r,t,n){void 0===r&&(r=""),void 0===t&&(t={}),void 0===n&&(n=!1);var o=this,i=o.$(),s=i.after,c=i.before,a=i.value,u=P(e),l=z(e),f=T(u+"$",""),p=T("^"+l,""),h=f.test(c),v=p.test(s);return v&&h?o.replace(p,"",1).replace(f,"",-1):(f=T("^"+u,""),p=T(l+"$",""),h=f.test(a),(v=p.test(a))&&h&&o.insert(a=a.replace(p,"").replace(f,"")),!a&&r&&o.insert(r),!1!==(n=Y(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+J(t)+">","</"+e+">"))},I.wrap=function(e,r,t,n){void 0===r&&(r=""),void 0===t&&(t={}),void 0===n&&(n=!1);var o=this,i=o.$();return i.after,i.before,!i.value&&r&&o.insert(r),!1!==(n=Y(n))&&o.trim(n[0],n[1]),o.wrap("<"+e+J(t)+">","</"+e+">")};var Q={source:{type:"XML"},sourceXML:{}},V=$.protocol,Z=I.toggle,ee="[\\w:.-]+",re=function(e){return"<("+e+")(\\s(?:'(?:\\\\.|[^'])*'|\"(?:\\\\.|[^\"])*\"|[^/>'\"])*)?>"},te=function(e){return"</("+e+")>"};function ne(e){return!1!==e&&(s(e)?e=[e,e]:r(e)||(e=["",""]),i(e[1])||(e[1]=e[0])),e}var oe={};oe.blocks=function(){var e=this;return e.record(),function(e){var r=/<(?:h([1-6])|p)(\s[^>]*)?>$/,t=/^<\/(?:h[1-6]|p)>/;e.match([r,/.*/,t],(function(n,o,i){var s=this,c=+(n[1]||0),a=n[2]||"",u=e.state.sourceHTML.elements||{},l=n[0]?u[n[0].slice(1,-1).split(/\s/)[0]]:["","",{}];!a&&l[2]&&(a=J(l[2])),s.replace(r,"",-1),s.replace(/\n+/g," "),s.replace(t,"",1);var f=l[3]||u.h1[3];!1!==(f=ne(f))&&s.trim(f[0],f[1]),c?++c>6?(s.wrap("<"+u.p[0]+(a||J(u.p[2]))+">","</"+u.p[0]+">"),o[0]&&o[0]!==u.h6[1]||s.insert(u.p[1])):(s.wrap("<"+u["h"+c][0]+(a||J(u["h"+c][2]))+">","</"+u["h"+c][0]+">"),o[0]&&o[0]!==u.p[1]||s.insert(u["h"+c][1])):(s.wrap("<"+u.h1[0]+(a||J(u.h1[2]))+">","</"+u.h1[0]+">"),o[0]&&o[0]!==u.p[1]||s.insert(u.h1[1]))}))}(e),e.record(),!1},oe.bold=function(){var e=this.state.sourceHTML.elements||{};return this.record(),Z.apply(this,e.b),!1},oe.code=function(){var e=this;return e.record(),function(e){var r=/<(?:pre|code)(?:\s[^>]*)?>(?:\s*<code(?:\s[^>]*)?>)?$/,t=/^(?:<\/code>\s*)?<\/(?:pre|code)>/;e.match([r,/.*/,t],(function(n,o,i){var s,c=this,a=e.state.sourceHTML.elements;c.replace(r,"",-1),c.replace(t,"",1),i[0]?/^(?:<\/code>\s*)?<\/pre>/.test(i[0])?(!1!==(s=ne(s=a[""][3]))&&c.trim(s[0],s[1]),c.insert(function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}(o[0]))):i[0].slice(0,7)==="</"+a.code[0]+">"&&(!1!==(s=ne(s=a.pre[3]))&&c.trim(s[0],s[1]),c.wrap("<"+a.pre[0]+J(a.pre[2])+"><"+a.code[0]+J(a.code[2])+">","</"+a.code[0]+"></"+a.pre[0]+">")):(!1!==(s=ne(s=a.code[3]))&&c.trim(s[0],s[1]),c.wrap("<"+a.code[0]+J(a.code[2])+">","</"+a.code[0]+">").insert(function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(o[0]||a.code[1])))}))}(e),e.record(),!1},oe.image=function(e,r){void 0===e&&(e="URL:");var n=this,o=n.$(),i=o.after,s=o.before,c=o.value,a=n.state,u=a.sourceHTML.elements||{},l=a.sourceHTML.tab||a.source.tab||a.tab||"\t",f=s.split("\n").pop().match(/^(\s+)/),p=f&&f[1]||"",h=a.source.prompt;return t(h)&&h(e,c&&/^https?:\/\/\S+$/.test(c)?c:r||V+"//").then((function(e){if(e){var r=u.img;c&&(r[2].alt=c,n.record());var t=r[3]||!1;!1!==(t=ne(t))&&n.trim(t[0],""),r[2].src=e,i&&"\n"!==i[0]||s&&"\n"!==s.slice(-1)?n.insert("<"+r[0]+J(r[2])+">"+(!1!==t?t[1]:""),-1,!0):(!1!==(t=ne(t=u.figure[3]||!1))&&n.trim(t[0],t[1]),n.insert(""),n.wrap(p+"<"+u.figure[0]+J(u.figure[2])+">\n"+p+l,p+"\n</"+u.figure[0]+">"),n.insert("<"+r[0]+J(r[2])+">\n"+p+l,-1),n.wrap("<"+u.figcaption[0]+J(u.figcaption[2])+">","</"+u.figcaption[0]+">").insert(u.figcaption[1]))}else n.focus()})),n.record(),!1},oe.italic=function(){var e=this.state.sourceHTML.elements||{};return this.record(),Z.apply(this,e.i),!1},oe.link=function(e,r){void 0===e&&(e="URL:");var n=this,o=n.$().value,i=n.state,s=i.sourceHTML.elements||{},c=i.source.prompt;return t(c)&&c(e,o&&/^https?:\/\/\S+$/.test(o)?o:r||V+"//").then((function(e){if(e){var r=s.a;o&&n.record(),r[2].href=e;var t={};/[.\/?&#]/.test(e[0])||/^(data|javascript|mailto):/.test(e)||-1===e.indexOf("://")||(t.rel="nofollow",t.target="_blank");var i=ne(r[3]||!1);!1!==i||o||(i=[" "," "]),Z.call(n,r[0],r[1],p(t,r[2]),i)}else n.focus()})),n.record(),!1},oe.quote=function(){var e=this;return e.record(),function(e){var r=/<(blockquote|q)(?:\s[^>]*)?>\s*$/,t=/^\s*<\/(blockquote|q)>/;e.match([r,/.*/,t],(function(n,o,i){var s,c=this,a=e.state,u=a.sourceHTML.tab||a.source.tab||a.tab||"\t",l=e.state.sourceHTML.elements||{};c.replace(r,"",-1),c.replace(t,"",1),i[0]?l.blockquote[0]===i[1]?!1!==(s=ne(l[""][3]))&&c.trim(s[0],s[1]):l.q[0]===i[1]&&(!1!==(s=ne(l.blockquote[3]))&&c.trim(s[0],s[1]),c.wrap("<"+l.blockquote[0]+J(l.blockquote[2])+">\n","\n</"+l.blockquote[0]+">").insert(o[0]||l.blockquote[1]),c.replace(T("(^|\\n)"),"$1"+u)):(!1!==(s=ne(l.q[3]))&&c.trim(s[0],s[1]),c.wrap("<"+l.q[0]+J(l.q[2])+">","</"+l.q[0]+">").insert(o[0]||l.q[1]),c.replace(T("(^|\\n)"+u),"$1"))}))}(e),e.record(),!1},oe.underline=function(){var e=this.state.sourceHTML.elements||{};return this.record(),Z.apply(this,e.u),!1};var ie={source:{type:"HTML"},sourceHTML:{elements:{"":["","text goes here…",{},""],a:["a","link text goes here…",{}],area:["area",!1,{}],b:["strong","text goes here…",{}],base:["base",!1,{href:""},"\n"],blockquote:["blockquote","",{},"\n"],br:["br",!1,{},["","\n"]],button:["button","text goes here…",{name:"",type:"submit"}," "],caption:["caption","caption goes here…",{},"\n"],code:["code","code goes here…",{}," "],col:["col",!1,{},"\n"],em:["em","text goes here…",{}],figcaption:["figcaption","caption goes here…",{},"\n"],figure:["figure","",{},"\n"],h1:["h1","title goes here…",{},"\n"],h2:["h2","title goes here…",{},"\n"],h3:["h3","title goes here…",{},"\n"],h4:["h4","title goes here…",{},"\n"],h5:["h5","title goes here…",{},"\n"],h6:["h6","title goes here…",{},"\n"],hr:["hr",!1,{},"\n"],i:["em","text goes here…",{}],img:["img",!1,{alt:"",src:""}," "],input:["input",!1,{name:"",type:"text"}," "],li:["li","list item goes here…",{},"\n"],link:["link",!1,{href:""},"\n"],meta:["meta",!1,{},"\n"],ol:["ol","",{},"\n"],option:["option","option goes here…",{},"\n"],p:["p","paragraph goes here…",{},"\n"],param:["param",!1,{name:""},"\n"],pre:["pre","text goes here…",{},"\n"],q:["q","quote goes here…",{}," "],script:["script","",{},"\n"],select:["select","",{name:""}," "],source:["source",!1,{src:""},"\n"],strong:["strong","text goes here…",{}],style:["style","",{},"\n"],td:["td","data goes here…",{},"\n"],textarea:["textarea","text goes here…",{name:""}," "],th:["th","title goes here…",{},"\n"],tr:["tr","",{},"\n"],track:["track",!1,{},"\n"],u:["u","text goes here…",{}],ul:["ul","",{},"\n"],wbr:["wbr",!1,{},["","\n"]]}}};function se(e){this.K.pull()}function ce(e){this.K.pull()}function ae(e){let r,t,n=this.TE,o=this.K,i=e.key,s=n.state.source.type;if(function(e){e&&e.stopPropagation()}(e),o.push(i),r=o.test())t=o.fire(r),!1===t?k(e):null===t&&console.error("Unknown command:",r);else{if("HTML"===s)return void(function(e,r){var t=r.state,n=t.sourceHTML.tab||t.source.tab||t.tab||"\t",o=t.sourceHTML.elements||{},i=e.key,s=e.queue;if(s.Control){var a=r.$(),u=a.after,l=a.before,f=a.end,p=a.start;a.value;var h=u.split("\n").shift(),v=l.split("\n").pop(),d=v.match(/^(\s+)/),m=d&&d[1]||"";if("Enter"===i){var g=h.match(T(te(ee)+"\\s*$","")),b=o[g&&g[1]||"p"]||o.p;return b[3]=["\n"+m,"\n"+m],r.select(s.Shift?p-c(v):f+c(h)),Z.apply(r,b),r.record(),!1}}if(s.Alt||s.Control)return!0;if(">"===i){var y,$=r.$(),w=$.after,k=$.before,S=$.end,x=(k.split("\n").pop()+">").match(T(re(ee)+"$","")),q=o[y=x&&x[1]||""];return!y||(q?!1!==q[1]?(">"===w[0]?r.select(S+1):r.insert(">",-1),r.insert("</"+y+">",1).insert(q[1])):">"===w[0]?r.insert(" /",-1).select(S+3):r.insert(" />",-1):(">"===w[0]?r.select(S+1):r.insert(">",-1),r.insert("</"+y+">",1)),r.record(),!1)}if("Enter"===i){var L,_,E=r.$(),C=E.after,M=E.before,A=E.value,H=C.split("\n").shift(),W=M.split("\n").pop(),j=W.match(/^(\s+)/),O=j&&j[1]||"",K=["li","option","p","td","th"],R=["script","style"];if(L=W.match(T(re(ee)+"$",""))){var X=o[L[1]];if(X&&!1===X[1])return r.insert("\n"+O,-1).record(),!1}if(C&&M){for(var U=0,D=c(K);U<D;++U)if(T("^"+te(_=K[U]),"").test(H)&&(L=W.match(T("^\\s*"+re(_),""))))return L[0]===W?(o[_]&&A&&o[_][1]===A?r.insert("").wrap("\n"+O+n,"\n"+O):Z.call(r,_),r.record(),!1):(r.insert("</"+_+">\n"+O+"<"+_+(L[2]||"")+">",-1).insert(o[_]&&o[_][1]||"").record(),!1);for(var B=0,N=c(R);B<N;++B)if(T("^"+te(_=R[B]),"").test(H)&&T(re(_)+"$","").test(W))return r.wrap("\n"+O,"\n"+O).insert(o[_]&&o[_][1]||"").record(),!1;for(var P=1;P<7;++P)if(H.startsWith("</"+o["h"+P][0]+">")&&W.match(T("^\\s*"+re(o["h"+P][0]),"")))return o["h"+P]&&A&&o["h"+P][1]===A?r.insert("").wrap("\n"+O+n,"\n"+O):r.insert("</"+o["h"+P][0]+">\n"+O+"<"+o.p[0]+">",-1).replace(T("^"+te(o["h"+P][0])),"</"+o.p[0]+">",1).insert(o.p[1]),r.record(),!1}}return!0}(o,n)&&G(o,n)&&H(o,n)&&W(o,n)&&j(o,n)&&O(o,n)&&K(o,n)||k(e));if("XML"===s)return void(G(o,n)&&H(o,n)&&W(o,n)&&j(o,n)&&O(o,n)&&K(o,n)||k(e));H(o,n)&&W(o,n)&&j(o,n)&&O(o,n)&&K(o,n)||k(e)}}function ue(e){let r=this.TE,t=this.K,n=e.key;!function(e,r){D(r)}(0,r),t.pull(n)}function le(r){let t=this.TE;!function(r,t){r.key,r.queue.Control||d.setTimeout((function(){var r=t.$(),n=r.after,o=r.before,i=r.value;if(!i)for(var s,a,u=F.split("([\\w:.-]+)").join("((?:[\\w:.-]|\ufeff)+)"),l=T(u),f=o+i+"\ufeff"+n;s=l.exec(f);)if(e("\ufeff",s[0])){t.select(a=s.index,a+c(s[0])-1);break}}),1)}(this.K,t)}function fe(){let e;for(let t in _.instances)e=_.instances[t],e.loss().pop(),delete e.self.K,delete _.instances[t],r=e.self,w("blur",r,se),w("input",r,ce),w("keydown",r,ae),w("keyup",r,ue),w("mousedown",r,le),w("touchstart",r,le);var r;let t,n,o,i,s=(a=".lot\\:field.type\\:source textarea",(u||v).querySelectorAll(a));var a,u;s&&c(s)&&s.forEach((e=>{t=new _(e,b(e,"state")??{}),o=t.state,i=o.source.type,n=new d.K(t),n.keys.Escape=function(){let e=function(e,r){return r?e.closest(r)||null:e.parentNode||null}(this.source,"[tabindex]:not(.not\\:active)");return!e||(e.focus(),!1)},"HTML"===i&&(n.commands=oe,n.keys["Control-b"]="bold",n.keys["Control-e"]="code",n.keys["Control-h"]="blocks",n.keys["Control-i"]="italic",n.keys["Control-k"]="link",n.keys["Control-o"]="image",n.keys["Control-q"]="quote",n.keys["Control-u"]="underline"),o.commands=n.commands,o.keys=n.keys,e.K=n,function(e){S("blur",e,se),S("input",e,ce),S("keydown",e,ae),S("keyup",e,ue),S("mousedown",e,le),S("touchstart",e,le),e.TE.record()}(e)}))}Object.assign(_.prototype,E,A),_.state=p({},_.state,B,Q,ie),["alert","confirm","prompt"].forEach((e=>{d._.dialog[e]&&(_.state.source[e]=d._.dialog[e])})),delete _.state.source.type,fe(),d._.on("change",fe),d.TE=_}();