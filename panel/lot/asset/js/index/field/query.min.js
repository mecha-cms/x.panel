!function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t,n){return t&&i(n)&&t instanceof n},r=function(t){return"number"==typeof t},u=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||e(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},c=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},f=function(t){return t.toLowerCase()},a=function(t){return t.length},s=function(t){return Object.keys(t)},l=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},v=function e(){for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];for(var f=o.shift(),s=0,l=a(o);s<l;++s)for(var v in o[s])if(i(f[v]))if(n(f[v])&&n(o[s][v])){f[v]=[].concat(f[v]);for(var g=0,p=a(o[s][v]);g<p;++g)t(o[s][v][g],f[v])||f[v].push(o[s][v][g])}else u(f[v])&&u(o[s][v])?f[v]=e({},f[v],o[s][v]):f[v]=o[s][v];else f[v]=o[s][v];return f},g=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},p=document,d=window,m=function(t,n,e){if(void 0===e&&(e=!0),!A(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},h=function(t,n){var e=t.children;return r(n)?e[n]||null:e||[]},b=function(t,n,e){void 0===e&&(e=!0);var r=m(t,"data-"+n,e),u=(r+"").trim();return e&&u&&("["===u[0]&&"]"===u.slice(-1)||"{"===u[0]&&"}"===u.slice(-1))&&null!==(u=function(t){var n=null;try{n=JSON.parse(t)}catch(t){}return n}(r))?u:r},y=function(t){return f(t&&t.nodeName||"")||null},k=function(t){return t.nextElementSibling||null},x=function(t){return t.parentNode||null},E=function(t){return t.previousElementSibling||null},w=function(t,n){return N(t,n)&&t[n]||null},L=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!N(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},A=function(t,n){return t.hasAttribute(n)},T=function(t,n){return t.classList.contains(n)},R=function(t){return null!==x(t)},N=function(t,n){return n in t},S=function(t,n){return t.removeAttribute(n),t},C=function(t,n){return t.classList.remove(n),t},O=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(u(e)){for(var r in e)e[r]&&t.classList.remove(r);return t}return t.className="",t},P=function(t){var n=x(t);return t.remove(),n},K=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,g(e)),t},_=function(t,n){return t.append(n),n},B=function(t,n){return t.classList.add(n),t},q=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(u(e))for(var r in e)e[r]?t.classList.add(r):t.classList.remove(r);return t.className=e,t},D=function(t,n,e){return t=o(t)?p.createElement(t):t,u(n)&&(e=n,n=!1),o(n)&&H(t,n),u(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?K(t,r,e):S(t,r)}(t,e),t},H=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return N(t,r)&&(t[r]=e?n.trim():n),t},z=function(t,n){return x(t).insertBefore(n,t),n},F=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return N(t,r)&&(t[r]=e?n.trim():n),t},I=function(t,n,e){n.removeEventListener(t,e)},J=function(t){return t&&t.preventDefault()},M=function(t,n,e){t.forEach((function(t){return I(t,n,e)}))},$=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},G=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return $(t,n,e,r)}))};var Q=function(t,n){return function(t){return e(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,i(n)?n:"g"))},U=d.setTimeout,V="ArrowLeft",W="Backspace";function X(u,l){if(void 0===l&&(l={}),u){var g=this;if(!u.TP){if(!e(g,X))return new X(u,l);var b=function(){return u.disabled},w=function(){return u.readOnly},A=m(u,"placeholder"),S=m(u,"tabindex"),K=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return i(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!i(e))return n={},t;if(i(n[e]))if(i(r)){for(var u=0,o=n[e].length;u<o;++u)if(r===n[e][u]){n[e].splice(u,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return i(n[e])||(n[e]=[]),i(r)&&n[e].push(r),t},t}(g);K.hooks;var H,Y=K.fire;g.state=l=v({},X.state,o(l)?{join:l}:l||{}),g.source=u,X.instances[u.id||u.name||(H=X.instances,a(s(H)))]=g,u.TP=1;var Z,tt,nt,et,rt=l.class,ut=rt+"__",it=rt+"--",ot=function(t){var n="form";if(N(t,n)&&n===y(t.form))return t.form;for(var e=x(t);e&&n!==y(e);)e=x(e);return e||null}(u),ct=D("span",{class:rt,tabindex:!b()&&"-1"}),ft=D("span",{class:ut+"tag "+ut+"text"}),at=D("input",{class:ut+"copy",type:"text"}),st=D("span",{contenteditable:!b()&&"true",spellcheck:"false",style:"white-space:pre;"}),lt=D("span"),vt=D("span",{class:ut+"tags"}),gt=0,pt={};return wt(""),_(ct,vt),_(ft,st),_(ft,lt),_(vt,ft),B(u,ut+"source"),et=ct,x(nt=u).insertBefore(et,k(nt)),D(u,{tabindex:"-1"}),$("blur",ct,Ht),$("click",ct,_t),$("focus",u,zt),$("keydown",ct,Ft),$("keydown",st,It),$("keyup",ct,Jt),$("paste",st,Mt),G(["blur","focus"],ct,Kt),G(["blur","focus"],at,Ct),G(["blur","focus"],st,Pt),G(["copy","cut","paste"],at,Dt),ot&&$("submit",ot,$t),g.blur=function(){return!b()&&st.blur(),g},g.click=function(){return ct.click(),_t(),g},g.f=function(t){return f(t||"").replace(/[^ a-z\d-]/g,"").trim()},g.focus=function(){return b()||wt(L(st),1),g},g.get=function(t){return b()?null:dt(t,1)},g.input=st,g.let=function(t){if(!b()&&!w()){var e=l.min;if(t)if(n(t))t.forEach((function(t){if(e>0&&a(g.tags)<e)return Y("min.tags",[e]),g;xt(t),kt(t)}));else{if(e>0&&a(g.tags)<e)return Y("min.tags",[e]),g;xt(t),kt(t)}else yt("")}return g},g.pop=function(){if(!u.TP)return g;delete u.TP;var t=g.tags;return C(u,ut+"source"),I("blur",ct,Ht),I("click",ct,_t),I("focus",u,zt),I("keydown",ct,Ft),I("keydown",st,It),I("keyup",ct,Jt),I("paste",st,Mt),M(["blur","focus"],ct,Kt),M(["blur","focus"],at,Ct),M(["blur","focus"],st,Pt),M(["copy","cut","paste"],at,Dt),ot&&I("submit",ot,$t),t.forEach(xt),D(u,{tabindex:S}),P(ct),Y("pop",[t])},g.self=ct,g.set=function(t,e){if(!t)return g;if(!b()&&!w())if(n(t))yt(t.join(l.join));else{var r=g.tags,u=l.max;dt(t)?Y("has.tag",[t,c(t,r)]):a(r)<u?(bt(t,e),ht(t,e)):Y("max.tags",[u])}return g},g.source=g.output=u,g.state=l,g.tags=[],yt(u.value),g}}function dt(t,n){var e=c(t,g.tags);return n&&Y("get.tag",[t,e]),r(e)?t:null}function mt(){pt={};var t,n=h(vt),e=a(n)-1;for(t=0;t<e;++t)T(n[t],ut+"tag--focus")&&(pt[t]=n[t])}function ht(t,n){r(n)?(n=n<0?0:n,g.tags.splice(n,0,t)):g.tags.push(t),u.value=g.tags.join(l.join)}function bt(t,n){var e=D("span",{class:ut+"tag",tabindex:!b()&&"0",title:t}),u=D("a",{class:ut+"tag-x",href:"",tabindex:"-1",target:"_top"});$("click",u,qt),_(e,u),$("click",e,Bt),G(["blur","focus"],e,Ot),R(vt)&&(r(n)&&g.tags[n]?z(h(vt,n),e):z(ft,e))}function yt(n){if(n=n?n.split(l.join):[],R(ct))for(var e,r,i;e=E(ft);)xt(i=e.title),t(i,n)||(r=c(i,g.tags),Y("change",[i,r]),Y("let.tag",[i,r]));g.tags=[],u.value="";for(var o,f=0,a=l.max;f<a&&n[f];++f)""!==(o=Nt(n[f]))&&(bt(o),ht(o),Y("change",[o,f]),Y("set.tag",[o,f]))}function kt(t){var n=c(t,g.tags);r(n)&&n>=0&&(g.tags.splice(n,1),u.value=g.tags.join(l.join))}function xt(t){var n,e=c(t,g.tags);if(r(e)&&e>=0&&(n=h(vt,e))){I("click",n,Bt),M(["blur","focus"],n,Ot);var u=n.firstElementChild||null;u&&(I("click",u,qt),P(u)),P(n)}}function Et(t){P(at),t&&wt("",1)}function jt(t){_(ct,at),at.value=g.tags.join(l.join),t&&(at.focus(),at.select())}function wt(t,n){if(F(st,t),F(lt,t?"":A),n){st.focus();var e=p.createRange(),r=d.getSelection();e.selectNodeContents(st),e.collapse(!1),r.removeAllRanges(),r.addRange(e)}}function Lt(t){Rt(t,(function(){C(this,ut+"tag--focus")}))}function At(t){Rt(t,(function(){B(this,ut+"tag--focus")}))}function Tt(){if(!b()&&!w()){var t=St(L(st)).trim(),n=l.pattern;if(n&&t&&!Q(n,"").test(t))return Y("not.tag",[t,-1]),void wt(t,1);if(wt(""),t=Nt(t))if(dt(t))Y("has.tag",[t,c(t,g.tags)]);else{bt(t),ht(t);var e=a(g.tags);Y("change",[t,e]),Y("set.tag",[t,e])}}}function Rt(t,n){var e,r=h(vt),u=a(r)-1;for(e=0;e<u;++e)t!==r[e]&&n.call(r[e],e)}function Nt(t){return St(g.f(t)).trim()}function St(t){return t=t||"",l.escape.forEach((function(n){t=t.split(n).join("")})),t}function Ct(t){"blur"===t.type?(Lt(),O(ct,[it+"focus",it+"focus-self"])):q(ct,[it+"focus",it+"focus-self"])}function Ot(t){if(!w()){pt={};var n=this,e=t.type,r=n.title,u=g.tags,i=c(r,u),o=ut+"tag--";"blur"===e?Z&&!tt||(Lt(n),C(n,o+"focus"),O(ct,[it+"focus",it+"focus-tag"])):(B(n,o+"focus"),q(ct,[it+"focus",it+"focus-tag"]),gt=i,pt[i]=n),Y(e+".tag",[r,i])}}function Pt(t){var n=g.tags,e=t.type,r=ut+"text--";"blur"===e?(C(ft,r+"focus"),O(ct,[it+"focus",it+"focus-text"]),Tt()):(B(ft,r+"focus"),q(ct,[it+"focus",it+"focus-text"]),Lt(ft)),Y(e,[n,a(n)])}function Kt(t){"blur"===t.type?C(ct,it+"focus"):B(ct,it+"focus")}function _t(t){t&&ct===t.target&&st.focus();var n=g.tags;Y("click",[n,a(n)])}function Bt(){var t=this.title,n=g.tags;Y("click.tag",[t,c(t,n)])}function qt(t){if(!b()&&!w()){var n=x(this).title,e=c(n,g.tags);xt(n),kt(n),wt("",1),Y("change",[n,e]),Y("click.tag",[n,e]),Y("let.tag",[n,e])}J(t)}function Dt(t){var n=t.type;"copy"===n?U((function(){return Et(1)})):"cut"===n?(!w()&&yt(""),U((function(){return Et(1)}))):"paste"===n&&U((function(){!w()&&yt(at.value),Et(1)})),U((function(){var t=g.tags;Y(n,[t,a(t)])}),1)}function Ht(){Lt(),C(ct,it+"focus-self")}function zt(){st.focus()}function Ft(t){if(!b()){g.tags;var n,e,r,u,i,o,c=t.key,f=t.ctrlKey,l=Z=t.shiftKey,v=ut+"tag--";if(tt="Tab"===c,!w())if(f)"a"===c&&(jt(1),At(),mt(),J(t));else if(l||W!==c&&"Delete"!==c){if("Home"===c)(n=h(vt,0))&&(n.focus(),J(t));else if("End"===c)(n=h(vt,a(g.tags)-1))&&(n.focus(),J(t));else if(V===c)if(n=h(vt,gt-1)){var p=T(n,v+"focus");n.focus(),J(t),l?(r=k(n),p&&C(r,v+"focus")):Lt(n)}else l||Lt(h(vt,0));else if("ArrowRight"===c&&(n=h(vt,gt+1))){var d=T(n,v+"focus");ft!==n||l?n.focus():wt("",1),J(t),l?(u=E(n),d&&C(u,v+"focus")):Lt(n)}}else{mt(),o=pt;var m=W===c;for(e in o)xt(i=(n=o[e]).title),kt(i);gt=+(s(o)[0]||0),(n=h(vt,m?gt-1:gt))?ft===n?wt("",1):n.focus():wt("",1),J(t)}}}function It(n){!function(t){t&&t.stopPropagation()}(n),w()&&J(n);var e,r=l.escape,u=E(ft),i=a(g.tags),o=l.max,c=Nt(L(st)),f=n.key,s=n.ctrlKey,v="Enter"===f;n.shiftKey;var p="Tab"===f;if(v&&(f="\n"),p&&(f="\t"),U((function(){var e=Nt(L(st));F(lt,e?"":A),t(function(t){var n,e=d.getSelection();if(e.rangeCount>0)return(n=e.getRangeAt(0).cloneRange()).collapse(!0),n.setStart(t,0),(n+"").slice(-1)}(st),r)&&(i<o?Tt():(wt(""),Y("max.tags",[o])),J(n))})),s&&""===c&&"a"===f)return jt(1),At(),mt(),void J(n);if(t(f,r))return i<o?Tt():(wt(""),Y("max.tags",[o])),void J(n);if(!p){if(!s&&v)return $t()&&ot&&ot.dispatchEvent(new Event("submit",{cancelable:!0})),void J(n);if(u&&""===c&&!w()){if(W===f)return xt(e=g.tags[i-1]),kt(e),Y("change",[e,i-1]),Y("let.tag",[e,i-1]),void J(n);if(V===f)return void u.focus()}}}function Jt(){Z=!1}function Mt(){U((function(){b()||w()||L(st).split(l.join).forEach((function(n){t(n,g.tags)||(bt(n),ht(n))})),wt("")}))}function $t(t){if(!b()){var n=l.min;return Tt(),n>0&&a(g.tags)<n?(wt("",1),Y("min.tags",[n]),void J(t)):1}}}function Y(){let t;for(let n in X.instances)t=X.instances[n],t.pop(),delete X.instances[n];let n=(e=".lot\\:field.type\\:query .input",(r||p).querySelectorAll(e));var e,r;n&&a(n)&&n.forEach((t=>{let n=function(t,n){void 0===n&&(n=!0);var e=(w(t,"className")||"").trim();return n?e.split(/\s+/):e}(t),e=new X(t,b(t,"state")??{});q(e.self,n)}))}X.instances={},X.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},X.version="3.3.3",Y(),d._.on("change",Y),d.TP=X}();